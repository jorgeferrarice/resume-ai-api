<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elevatr Chat Example</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .header h1 {
            color: #4a5568;
            margin: 0;
        }

        .header p {
            color: #718096;
            margin: 10px 0;
        }

        .chat-container {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            height: 400px;
            display: flex;
            flex-direction: column;
            background: #f8fafc;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }

        .message.user {
            align-self: flex-end;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .message.assistant {
            align-self: flex-start;
            background: white;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .message .role {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .message .content {
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .message .timestamp {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 4px;
        }

        .typing {
            align-self: flex-start;
            background: white;
            border: 1px solid #e2e8f0;
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            color: #718096;
            font-style: italic;
        }

        .input-container {
            padding: 15px;
            border-top: 1px solid #e2e8f0;
            background: white;
            border-radius: 0 0 8px 8px;
            display: flex;
            gap: 10px;
        }

        .input-container input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .input-container input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-container button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .input-container button:hover:not(:disabled) {
            transform: translateY(-1px);
        }

        .input-container button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .controls button {
            padding: 8px 16px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .controls button:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #feb2b2;
        }

        .success {
            background: #c6f6d5;
            color: #276749;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #9ae6b4;
        }

        .usage-info {
            font-size: 12px;
            color: #718096;
            text-align: center;
            margin-top: 10px;
        }

        .quick-actions {
            margin-bottom: 15px;
        }

        .quick-actions button {
            margin: 5px;
            padding: 6px 12px;
            background: #edf2f7;
            border: 1px solid #e2e8f0;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .quick-actions button:hover {
            background: #e2e8f0;
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .message {
                max-width: 90%;
            }
            
            .controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Elevatr Chat Demo</h1>
            <p>Your fun and nerdy AI career assistant</p>
        </div>

        <div class="controls">
            <button onclick="clearChat()">üóëÔ∏è New Chat</button>
            <button onclick="loadExample()">üí° Load Example</button>
            <button onclick="toggleSettings()">‚öôÔ∏è Settings</button>
            <button onclick="checkAPI()">üîç Test API</button>
        </div>

        <div id="notification"></div>

        <div class="quick-actions" id="quickActions">
            <div style="margin-bottom: 8px; font-weight: 600; color: #4a5568;">Quick questions:</div>
            <button onclick="sendQuickMessage('Help me improve my resume')">üìã Improve Resume</button>
            <button onclick="sendQuickMessage('Analyze my technical skills section')">üíª Tech Skills</button>
            <button onclick="sendQuickMessage('How can I make my experience more impactful?')">üöÄ Experience Tips</button>
            <button onclick="sendQuickMessage('What keywords should I include for a senior developer role?')">üîë Keywords</button>
        </div>

        <div class="chat-container">
            <div class="messages" id="messages">
                <div class="message assistant">
                    <div class="role">ü§ñ Elevatr</div>
                    <div class="content">Hey there! üëã I'm Elevatr, your friendly neighborhood career AI! Ready to help you level up your resume and ace that next opportunity? 

What would you like to work on today? I can analyze your resume, help with specific sections, or even match it against a job description. Let's make your resume legendary! üéÆ</div>
                    <div class="timestamp">Ready to help</div>
                </div>
            </div>
            <div class="input-container">
                <input 
                    type="text" 
                    id="messageInput" 
                    placeholder="Ask Elevatr about your resume..."
                    maxlength="4000"
                    onkeydown="handleKeyDown(event)"
                />
                <button id="sendButton" onclick="sendMessage()">üì§ Send</button>
            </div>
        </div>

        <div class="usage-info" id="usageInfo">
            üí° Tip: Ask specific questions for better advice! Example: "How can I improve my React experience section?"
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000/api';
        let conversationId = null;
        let isLoading = false;

        // DOM Elements
        const messagesContainer = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const notification = document.getElementById('notification');
        const usageInfo = document.getElementById('usageInfo');

        // Utility Functions
        function showNotification(message, type = 'error') {
            notification.innerHTML = `<div class="${type}">${message}</div>`;
            setTimeout(() => notification.innerHTML = '', 5000);
        }

        function formatTime(timestamp) {
            return new Date(timestamp || Date.now()).toLocaleTimeString([], {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function scrollToBottom() {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function updateUsageInfo(usage) {
            if (usage) {
                usageInfo.innerHTML = `üìä Tokens used: ${usage.total_tokens} (prompt: ${usage.prompt_tokens}, response: ${usage.completion_tokens})`;
            }
        }

        // Message Functions
        function addMessage(role, content, timestamp = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            messageDiv.innerHTML = `
                <div class="role">${role === 'user' ? 'üë§ You' : 'ü§ñ Elevatr'}</div>
                <div class="content">${content}</div>
                <div class="timestamp">${formatTime(timestamp)}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = 'ü§ñ Elevatr is thinking...';
            messagesContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTyping() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function updateSendButton(loading) {
            isLoading = loading;
            sendButton.disabled = loading;
            sendButton.innerHTML = loading ? '‚è≥ Sending...' : 'üì§ Send';
        }

        // API Functions
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || isLoading) return;

            // Add user message immediately
            addMessage('user', message);
            messageInput.value = '';
            updateSendButton(true);
            showTyping();

            try {
                const requestBody = {
                    message,
                    ...(conversationId && { conversationId })
                };

                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'Failed to send message');
                }

                // Update conversation ID if new conversation
                if (data.data.isNewConversation) {
                    conversationId = data.data.conversationId;
                    showNotification('‚úÖ New conversation started!', 'success');
                }

                // Add assistant response
                hideTyping();
                addMessage('assistant', data.data.message, new Date().toISOString());

                // Update usage info
                if (data.usage) {
                    updateUsageInfo(data.usage);
                }

            } catch (error) {
                hideTyping();
                showNotification(`‚ùå Error: ${error.message}`);
                console.error('Chat error:', error);
            } finally {
                updateSendButton(false);
                messageInput.focus();
            }
        }

        function sendQuickMessage(message) {
            messageInput.value = message;
            sendMessage();
        }

        async function checkAPI() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                if (data.success) {
                    showNotification('‚úÖ API is running and healthy!', 'success');
                } else {
                    throw new Error('API health check failed');
                }
            } catch (error) {
                showNotification(`‚ùå API not accessible: ${error.message}`);
            }
        }

        function clearChat() {
            conversationId = null;
            messagesContainer.innerHTML = `
                <div class="message assistant">
                    <div class="role">ü§ñ Elevatr</div>
                    <div class="content">Fresh start! üéØ What can I help you with today? Whether it's resume analysis, career advice, or just a friendly chat about your professional journey - I'm here for you!</div>
                    <div class="timestamp">${formatTime()}</div>
                </div>
            `;
            usageInfo.innerHTML = 'üí° Tip: Ask specific questions for better advice!';
            showNotification('‚úÖ New conversation started!', 'success');
            messageInput.focus();
        }

        function loadExample() {
            const examples = [
                "Hi Elevatr! I'm a senior developer with 20+ years experience. Can you help me optimize my resume for modern tech roles?",
                "I work with PHP, React, Flutter, and AWS. How should I present these skills effectively?",
                "What's the best way to showcase leadership experience when mentoring junior developers?",
                "I'm transitioning from PHP to more modern stacks. How should I position this in my resume?"
            ];
            
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            messageInput.value = randomExample;
            messageInput.focus();
        }

        function toggleSettings() {
            const settings = prompt(`‚öôÔ∏è Settings:\n\nCurrent API URL: ${API_BASE_URL}\n\nEnter new API URL (or press Cancel to keep current):`);
            if (settings && settings !== API_BASE_URL) {
                // In a real app, you'd update the API_BASE_URL here
                showNotification('‚ÑπÔ∏è Settings would be updated in a real app');
            }
        }

        // Event Handlers
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            messageInput.focus();
            checkAPI(); // Check if API is available on load
            
            // Add some helpful keyboard shortcuts info
            console.log('üéÆ Keyboard shortcuts:');
            console.log('  Enter: Send message');
            console.log('  Shift+Enter: New line');
            console.log('');
            console.log('üí° Try asking Elevatr about:');
            console.log('  - Resume analysis and optimization');
            console.log('  - Technical skills presentation');
            console.log('  - Career advice and tips');
            console.log('  - Job matching and keywords');
        });

        // Add some fun easter eggs
        const easterEggs = [
            "Tell me about your favorite programming language!",
            "What's your take on the latest tech trends?",
            "Any advice for someone learning to code?",
            "What would you do if you could automate one boring task?",
            "If programming languages were D&D classes, what would TypeScript be?"
        ];

        function triggerEasterEgg() {
            const randomEgg = easterEggs[Math.floor(Math.random() * easterEggs.length)];
            sendQuickMessage(randomEgg);
        }

        // Secret konami code easter egg
        let konamiCode = [];
        const konami = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65]; // Up, Up, Down, Down, Left, Right, Left, Right, B, A

        document.addEventListener('keydown', function(e) {
            konamiCode.push(e.keyCode);
            if (konamiCode.length > konami.length) {
                konamiCode.shift();
            }
            
            if (konamiCode.length === konami.length && konamiCode.every((val, i) => val === konami[i])) {
                triggerEasterEgg();
                konamiCode = [];
                showNotification('üéÆ Easter egg activated! Elevatr is feeling extra nerdy today!', 'success');
            }
        });
    </script>
</body>
</html>
